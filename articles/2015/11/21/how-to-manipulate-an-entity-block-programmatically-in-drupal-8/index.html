<!DOCTYPE HTML>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
  <head>
    <title>How to manipulate an Entity:Block programmatically in Drupal 8</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="generator" content="Spress" />
<meta name="description" content="Enzo's blog" />
<meta name="keywords" content="" />


<!-- Twitter Cards -->
<meta name="twitter:title" content="Welcome to [enzo]lutions">
<meta name="twitter:description" content="{ page.description | default(site.description) }}">
<meta name="twitter:site" content="@enzolutions">
<meta name="twitter:creator" content="@">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://enzolutions.com/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Welcome to [enzo]lutions">
<meta property="og:description" content="Enzo's blog">
<meta property="og:url" content="http://enzolutions.com">
<meta property="og:site_name" content="Welcome to [enzo]lutions">

<link rel="canonical" href="http://enzolutions.com">
<link href="http://enzolutions.com/rss.xml" type="application/atom+xml" rel="alternate" title="Welcome to [enzo]lutions">
<link rel="author" href="enzolutions">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://enzolutions.com/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://enzolutions.com/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://enzolutions.com/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://enzolutions.com/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://enzolutions.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://enzolutions.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://enzolutions.com/assets/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://enzolutions.com/assets/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://enzolutions.com/assets/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://enzolutions.com/assets/images/apple-touch-icon-144x144-precomposed.png">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
<link rel="stylesheet" href="http://enzolutions.com/assets/css/highlight-theme.css">
  </head>

  <body class="home">
    <!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

    <div class="navigation-wrapper">
  <div class="site-name">
    <a href="http://enzolutions.com">[enzo]lutions</a>
  </div><!-- /.site-name -->
  <div class="top-navigation">
          <ul class="inline">
                    <li>
            <a href="http://enzolutions.com/"  >
              Home</a>
          </li>
                    <li>
            <a href="http://enzolutions.com/company"  >
              Company</a>
          </li>
                    <li>
            <a href="http://enzolutions.com/projects"  >
              Projects</a>
          </li>
                    <li>
            <a href="http://enzolutions.com/talks"  >
              Talks</a>
          </li>
                </ul>
      </div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->

          <div class="image-wrap">
  <img src="http://enzolutions.com/assets/images/blog_header_baby_turtle.png" alt="feature image">
  <span class="image-credit">Photo Credit: <a target="_blank" href="https://twitter.com/yersika">Yersika Ferreira</a></span>
</div><!-- /.image-wrap -->
    
  <div id="main" role="main">
    <div class="article-author-side">
      <img src="http://enzolutions.com/assets/images/enzo.png" class="bio-photo" alt="enzo - Eduardo Garcia bio photo">

<h3>enzo - Eduardo Garcia</h3>
<p>Home of crazy things I did just for fun</p>

<p> <a href="http://en.wikipedia.org/wiki/Costa_Rica" target="_blank"><img class="alignleft" src="http://enzolutions.com/assets/img/flags/cr.png" /></a> Current location</p>


<a href="http://twitter.com/enzolutions" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>

<a href="http://facebook.com/enzolutions" class="author-social" target="_blank"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a>

<a href="http://plus.google.com/105943717171843527124" class="author-social" target="_blank"><i class="fa fa-fw fa-google-plus-square"></i> Google+</a>


<a href="http://github.com/enzolutions" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>

<a href="http://linkedin.com/in/edugarcia" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>

<a href="http://enzolutions.com/rss.xml" class="author-social" target="_blank"><i class="fa fa-fw fa-rss"></i> Feed</a>
    </div>

  .
<article class="post">
  <div class="headline-wrap">
          <h1><a href="http://enzolutions.com/articles/2015/11/21/how-to-manipulate-an-entity-block-programmatically-in-drupal-8/" rel="bookmark" title="How to manipulate an Entity:Block programmatically in Drupal 8">How to manipulate an Entity:Block programmatically in Drupal 8</a></h1>
      </div><!--/ .headline-wrap -->
  <div class="article-wrap">
    <div class="social-share">
  <ul class="inline-list">
    <li class="facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://enzolutions.com/articles/2015/11/21/how-to-manipulate-an-entity-block-programmatically-in-drupal-8/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Share</span></a>
    </li>
    <li class="twitter">
      <a href="https://twitter.com/intent/tweet?text=http://enzolutions.com/articles/2015/11/21/how-to-manipulate-an-entity-block-programmatically-in-drupal-8/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a>
    </li>
    <li class="googleplus">
      <a href="https://plus.google.com/share?url=http://enzolutions.com/articles/2015/11/21/how-to-manipulate-an-entity-block-programmatically-in-drupal-8/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a>
    </li>
  </ul>
</div>

    <p>This is my first post after Drupal 8 got his first official release, now it's time to start to do some basic stuff using the Drupal 8 way.</p>

<p>Even I have been working a lot with Drupal 8 core, there are some typical things that I found still a little bit strange. But being honest if more my fault that Drupal 8 fault; All we have just to adjust own mental mindsets.</p>

<p>Today I want to show you how to deal with Block in Drupal 8 because yesterday I spent several hours trying to understand how to manipulate a block to extend a functionality for <a href="http://drupalconsole.com">Drupal Console</a> project.</p>

<h1>Get a list of blocks</h1>

<p>This looks an easy task, but there are some considerations you must take into account.</p>

<p>First, Do you need a list of all <em>Blocks</em> available or all <em>Blocks</em> enabled?</p>

<p>Why this separation is important, well as you maybe know or hear in Drupal 8 blocks are plugins and use <a href="https://www.drupal.org/node/1882526">annotations</a> to expose to Drupal 8 their existence. Therefore, we could get a list of blocks but they will not be <a href="https://api.drupal.org/api/drupal/core!modules!block!src!Entity!Block.php/8">Entity:Block</a> objects, we could get just their definition, this is important because you can't manipulate them, so you just can use as extra information in your logic.</p>

<p>Only blocks that are enabled and assigned to a theme and in a region are Entity:Block instances.</p>

<h2>Get available blocks</h2>

<p>Using the service <strong><a href="https://api.drupal.org/api/drupal/core!core.services.yml/service/plugin.manager.block/8">plugin.manager.block</a></strong> we will get all blocks available definition.</p>

<pre><code>$blockManager = \Drupal::service('plugin.manager.block');
$contextRepository = \Drupal::service('context.repository');

// Get blocks definition
$definitions = $blockManager-&gt;getDefinitionsForContexts($contextRepository-&gt;getAvailableContexts());

print_r($definitions['help_block']);
</code></pre>

<p>Executing the code above we will an output for <em>help_block</em> similar to the following snippet.</p>

<pre><code>Array
(
    [admin_label] =&gt; Drupal\Core\StringTranslation\TranslatableMarkup Object
        (
            [string:protected] =&gt; Help
            [translatedMarkup:protected] =&gt;
            [options:protected] =&gt; Array
                (
                )

            [stringTranslation:protected] =&gt;
            [arguments:protected] =&gt; Array
                (
                )

        )

    [category] =&gt; Help
    [derivative] =&gt;
    [id] =&gt; help_block
    [class] =&gt; Drupal\help\Plugin\Block\HelpBlock
    [provider] =&gt; help
)
</code></pre>

<p>As you can see is valuable information about the block but it's not a real Entity:Block instances.</p>

<h2>Get a list of all Entity:Block available</h2>

<p>Using <a href="https://api.drupal.org/api/drupal/core!lib!Drupal.php/function/Drupal%3A%3AentityQuery/8">Drupal:entityQuery</a> class, we can build a kind of SQL query for a specific entity in this case for Block entities. The following piece of code gets the full list of blocks available.</p>

<pre><code>$ids = \Drupal::entityQuery('block')-&gt;execute();
</code></pre>

<p>Off course we can filter the results, for instance, we could use the condition plugin to fetch all block related with help module, as you can see in the following snippet of code.</p>

<pre><code>$ids = \Drupal::entityQuery('block')
    -&gt;condition('plugin', 'help_block')
    -&gt;execute();

print_r($ids);
</code></pre>

<p>After executing the code above we could get an output similar this:</p>

<pre><code>Array
(
    [bartik_help] =&gt; bartik_help
    [himalaya_help] =&gt; himalaya_help
    [seven_help] =&gt; seven_help
)
</code></pre>

<p>I got three Entity:Block ids, related to the three themes I have enabled in my system Bartik, Seven and <a href="https://www.drupal.org/project/himalaya">Himalaya</a>.</p>

<h1>Loading an Entity:Block</h1>

<p>Until now we get definition of blocks and Entity:Block ids, but not a real Entity:Block, let me show you how do that using the Drupal 8 class use <a href="https://api.drupal.org/api/drupal/core%21modules%21block%21src%21Entity%21Block.php/class/Block/8">Drupal\block\Entity\Block</a> as you can see below.</p>

<pre><code>use Drupal\block\Entity\Block;
$block = Block::load('bartik_help');
print_r($block);
</code></pre>

<p>The code above load the Entity:Block for <strong>bartik_help</strong>, if you execute this code in your custom module you will get an output like this.</p>

<pre><code>Drupal\block\Entity\Block Object
(
    [id:protected] =&gt; bartik_help
    [settings:protected] =&gt; Array
        (
            [id] =&gt; help_block
            [label] =&gt; Help
            [provider] =&gt; help
            [label_display] =&gt; 0
        )

    [region:protected] =&gt; content
    [weight:protected] =&gt; -30
    [plugin:protected] =&gt; help_block
    [visibility:protected] =&gt; Array
        (
        )
......
......
    [dependencies:protected] =&gt; Array
        (
            [module] =&gt; Array
                (
                    [0] =&gt; help
                )

            [theme] =&gt; Array
                (
                    [0] =&gt; bartik
                )

        )

    [provider] =&gt;
)
</code></pre>

<h1>Create an Entity:Block</h1>

<p>Last but not least, I will show you how to create an Entity:Block from code definition.</p>

<p>Imagine did you created a block plugin using <strong>Drupal Console</strong> with id default_block. Using the following command.</p>

<pre><code>$ drupal generate:plugin:block
</code></pre>

<p>If you want to enable that generated block programmatically, you can use the following snippet of code.</p>

<pre><code>$blockEntityManager = \Drupal::service('entity.manager')-&gt;getStorage('block');
$block = $blockEntityManager-&gt;-&gt;create(
  array(
      'id'=&gt; $plugin_id,
      'plugin' =&gt; $plugin_id,
      'theme' =&gt; $theme
  )
);
$block-&gt;setRegion('content');
$block-&gt;save();
</code></pre>

<p>Besides, I decided to assign the default_block inside Content region for theme Bartik, after creating the Entity:Block.</p>

<p>I hope you found this article useful.</p>

    <hr />
    <footer role="contentinfo">
              <ul class="list-unstyled">
                            <li>
                    <i class="fa fa-tags"></i>
                    Drupal, Drupal8
                </li>
                                        <li>
                    <i class="fa fa-folder"></i>
                    articles
                </li>
                    </ul>
          </footer>
  </div><!-- /.article-wrap -->
    <section>
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
    <noscript>
      Please enable JavaScript to view the
      <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </section>

      <script type="text/javascript">
        var disqus_shortname = 'enzolutions';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
  </article>

</div><!-- /#main -->

<div class="footer-wrap">
  <footer>
    <span>&copy; 2015 enzo - Eduardo Garcia.
            Design by <a target="_blank" href="https://mademistakes.com/">Michael Rose</a>,
          </li> Powered by <a target="_blank"href="http://spress.yosymfony.com">Spress</a> using the <a target="_blank" href="https://github.com/enzolutions/spress-tinto-theme/">Tinto</a> theme.</span>
<br/>
  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://enzolutions.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://enzolutions.com/assets/js/scripts.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


      <!-- Google Analytics Tracker -->
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-17944133-1', 'enzolutions.com');
        ga('send', 'pageview');
      </script>
      <!-- End of Google Analytics Tracker -->
 </body> 
</html>

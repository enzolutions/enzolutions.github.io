<!DOCTYPE HTML>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
  <head>
    <title>How to include PHP code in Drupal 8 Views</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="generator" content="Spress" />
<meta name="description" content="Enzo's blog" />
<meta name="keywords" content="" />


<!-- Twitter Cards -->
<meta name="twitter:title" content="Welcome to [enzo]lutions">
<meta name="twitter:description" content="{ page.description | default(site.description) }}">
<meta name="twitter:site" content="@enzolutions">
<meta name="twitter:creator" content="@">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://enzolutions.com/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Welcome to [enzo]lutions">
<meta property="og:description" content="Enzo's blog">
<meta property="og:url" content="http://enzolutions.com">
<meta property="og:site_name" content="Welcome to [enzo]lutions">

<link rel="canonical" href="http://enzolutions.com">
<link href="http://enzolutions.com/rss.xml" type="application/atom+xml" rel="alternate" title="Welcome to [enzo]lutions">
<link rel="author" href="enzolutions">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://enzolutions.com/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://enzolutions.com/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://enzolutions.com/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://enzolutions.com/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://enzolutions.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://enzolutions.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://enzolutions.com/assets/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://enzolutions.com/assets/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://enzolutions.com/assets/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://enzolutions.com/assets/images/apple-touch-icon-144x144-precomposed.png">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
<link rel="stylesheet" href="http://enzolutions.com/assets/css/highlight-theme.css">
  </head>

  <body class="home">
    <!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

    <div class="navigation-wrapper">
  <div class="site-name">
    <a href="http://enzolutions.com">[enzo]lutions</a>
  </div><!-- /.site-name -->
  <div class="top-navigation">
          <ul class="inline">
                    <li>
            <a href="http://enzolutions.com/"  >
              Home</a>
          </li>
                    <li>
            <a href="http://enzolutions.com/company"  >
              Company</a>
          </li>
                    <li>
            <a href="http://enzolutions.com/projects"  >
              Projects</a>
          </li>
                    <li>
            <a href="http://enzolutions.com/talks"  >
              Talks</a>
          </li>
                </ul>
      </div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->

          <div class="image-wrap">
  <img src="http://enzolutions.com/assets/images/blog_header_baby_turtle.png" alt="feature image">
  <span class="image-credit">Photo Credit: <a target="_blank" href="https://twitter.com/yersika">Yersika Ferreira</a></span>
</div><!-- /.image-wrap -->
    
  <div id="main" role="main">
    <div class="article-author-side">
      <img src="http://enzolutions.com/assets/images/enzo.png" class="bio-photo" alt="enzo - Eduardo Garcia bio photo">

<h3>enzo - Eduardo Garcia</h3>
<p>Home of crazy things I did just for fun</p>

<p> <a href="http://en.wikipedia.org/wiki/Costa_Rica" target="_blank"><img class="alignleft" src="http://enzolutions.com/assets/img/flags/cr.png" /></a> Current location</p>


<a href="http://twitter.com/enzolutions" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>

<a href="http://facebook.com/enzolutions" class="author-social" target="_blank"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a>

<a href="http://plus.google.com/105943717171843527124" class="author-social" target="_blank"><i class="fa fa-fw fa-google-plus-square"></i> Google+</a>


<a href="http://github.com/enzolutions" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>

<a href="http://linkedin.com/in/edugarcia" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>

<a href="http://enzolutions.com/rss.xml" class="author-social" target="_blank"><i class="fa fa-fw fa-rss"></i> Feed</a>
    </div>

  .
<article class="post">
  <div class="headline-wrap">
          <h1><a href="http://enzolutions.com/articles/2015/10/11/how-to-include-php-code-in-drupal-8-views/" rel="bookmark" title="How to include PHP code in Drupal 8 Views">How to include PHP code in Drupal 8 Views</a></h1>
      </div><!--/ .headline-wrap -->
  <div class="article-wrap">
    <div class="social-share">
  <ul class="inline-list">
    <li class="facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://enzolutions.com/articles/2015/10/11/how-to-include-php-code-in-drupal-8-views/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Share</span></a>
    </li>
    <li class="twitter">
      <a href="https://twitter.com/intent/tweet?text=http://enzolutions.com/articles/2015/10/11/how-to-include-php-code-in-drupal-8-views/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a>
    </li>
    <li class="googleplus">
      <a href="https://plus.google.com/share?url=http://enzolutions.com/articles/2015/10/11/how-to-include-php-code-in-drupal-8-views/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a>
    </li>
  </ul>
</div>

    <p>Did you recall the last time you tried to resolve an issue in your program using a small piece of PHP in your views using <a href="https://www.drupal.org/project/views_customfield">Views Custom Field</a> in Drupal 6 and  <a href="https://www.drupal.org/project/views_php">Views PHP</a> in Drupal 7? Don't lie everybody did that at least once.</p>

<p>Even the fact those are accepted module by Drupal security team, this solution is really dangerous because execute code using PHP function <a href="http://php.net/manual/es/function.eval.php">eval</a>, execute PHP code loaded from DB it's really bad in terms of security and stability.</p>

<p>Moreover, if someone is auditing your code, this one is the first bad practice the auditor will try to find in your code and you will get a nice recommendation that you must create your own view field handler to do that in order to improve the quality of your code. But to be honest I did that in the past and even I did that several times, I always found this process really hard.</p>

<p>Nowadays the Drupal community is excited about the release of first release candidate for <a href="https://www.drupal.org/drupal-8.0.0-rc1">Drupal RC1</a>, so I though it's time to start with the classical posts about how to do our old practices in this new thing. Today I will share wit your how to avoid the usage of Views PHP modules and be able to include PHP in your views but still pass the audit of your code :P.</p>

<p>In this post I will use the project <a href="http://drupalconsole.com">Drupal Console</a> to facilitate my job.</p>

<h1>1. Create a Drupal 8 module.</h1>

<p>To generate a module you have two options, the first one is using the interactive mode, where the application will ask you all options available in the command. Use the following command to execute the interactive mode, check the following image to see a classical execution.</p>

<pre><code>$ drupal generate:module
</code></pre>

<p><img src="http://enzolutions.com/assets/img/console_generate_module.png"/></p>

<p>The second option execute the command but passing all options inline as you can see below.</p>

<pre><code>$ drupal generate:module --module="No Views PHP" --machine-name=no_views_php --module-path=/modules/custom --description="Custom views field to include PHP logic in views." --core=8.x --package=Other
</code></pre>

<h1>2. Generate a custom views field</h1>

<p>Views are now in core of Drupal 8, and everything change. As I said before "Drupal 8 is just a new project with same name and logic". So if you knew something about views, well that is not too much useful in terms of code, but the logic in general remains.</p>

<p>In Drupa 8 views everything in handle via Plugins and fields are not the exception, if you need to create a custom field you must generate a custom views plugin field. Fortunately I did a generator in <strong>Drupal Console</strong> for this task, check the following command to generate a views plugin field.</p>

<pre><code>$ drupal generate:plugin:views:field --module=no_views_php --class-name=PHPViewsField --title="PHP Field" --description="Enable to include and run PHP code in your modules as part of a view"
</code></pre>

<p>The command above will generate the following files:</p>

<pre><code>Site path: /Users/enzo/www/drupal8-rc1
1 - modules/custom/no_views_php/no_views_php.views.inc
2 - modules/custom/no_views_php/src/Plugin//views/field/PHPViewsField.php
</code></pre>

<h1>3. Install your module.</h1>

<p>Now we need to install our generated module with the following command.</p>

<pre><code>$ drupal module:install no_views_php
</code></pre>

<p>Now if you edit the Frontpage view at <strong>http://example.com/admin/structure/views/view/frontpage</strong> you can use the custom field generated after change the mode from show <em>content</em> to show <em>fields</em> as you can see in the following image.</p>

<p><img src="http://enzolutions.com/assets/img/views_custom_plugin.png"/></p>

<p>Pro tip: If you don't see your generated field, try executing <strong>$ drupal cache:rebuild all</strong> again :P</p>

<p>After apply the minimal configuration to the field, you will get a view preview similar to this image:</p>

<p><img src="http://enzolutions.com/assets/img/view_frontpage_preview.png"/></p>

<p>The view plugin field generated by default return a random string just to show that it's working. Now you have to do your magic in your custom module.</p>

<h1>4. Implementing your logic</h1>

<p>In order to implement your custom logic you have to edit the generated file <strong>modules/custom/no_views_php/src/Plugin//views/field/PHPViewsField.php</strong> and more specific inside the method <strong>render</strong>, this method receive an object of <a href="https://api.drupal.org/api/drupal/core!modules!views!src!ResultRow.php/class/ResultRow/8">Drupal\views\ResultRow</a> as parameter.</p>

<p>The default method generated looks like next snippet.</p>

<p><code>public function render(ResultRow $values) {
    // Return a random text, here you can include your custom logic.
      // Include any namespace required to call the method required to generte the
      // output desired
      $random = new Random();
      return $random-&gt;name();
  }</code></p>

<p>Now I will change the logic to use the title field in row to print it reversed, as you can check in the following code.</p>

<p><code>public function render(ResultRow $values) {
      // Return a random text, here you can include your custom logic.
      // Include any namespace required to call the method required to generte the
      // output desired
      $title = strip_tags($this-&gt;view-&gt;field['title']-&gt;original_value);
      return strrev($title);
  }</code></p>

<p>As result now our field will looks different, check the following image.</p>

<p><img src="http://enzolutions.com/assets/img/view_frontpage_preview2.png"/></p>

<p>As you can see this another silly implementation of a custom PHP, but now you can include in this class any service required to do you magic and transform each row in a view using other row fields as input.</p>

<p>Even better you can include in your code a handler to throw an exception if is required, so you code could as complex an professional as you want.</p>

<p>If you are wondering why don't contribute this as a replacement of views php in Drupal 8, well I though due we have a Drupal Console generator for that, it's not necessary. Inside Drupal Console project is the ethernal discussion about what things must be a generator and what others must be modules.</p>

<p>Some of them became in both a generator and Drupal 8 modules, check out the following list</p>

<ul>
<li><a href="https://www.drupal.org/project/entity_rest_extra">Entity Rest Extra</a></li>
<li><a href="https://www.drupal.org/project/ip_consumer_auth">IP Consumer Auth</a></li>
<li><a href="https://www.drupal.org/project/image_raw_formatter">Image Raw Formatter</a></li>
</ul>

<p>I hope you found this blog post useful.</p>

    <hr />
    <footer role="contentinfo">
              <ul class="list-unstyled">
                            <li>
                    <i class="fa fa-tags"></i>
                    Drupal8, Views, PHP
                </li>
                                        <li>
                    <i class="fa fa-folder"></i>
                    articles
                </li>
                    </ul>
          </footer>
  </div><!-- /.article-wrap -->
    <section>
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
    <noscript>
      Please enable JavaScript to view the
      <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </section>

      <script type="text/javascript">
        var disqus_shortname = 'enzolutions';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
  </article>

</div><!-- /#main -->

<div class="footer-wrap">
  <footer>
    <span>&copy; 2015 enzo - Eduardo Garcia.
            Design by <a target="_blank" href="https://mademistakes.com/">Michael Rose</a>,
          </li> Powered by <a target="_blank"href="http://spress.yosymfony.com">Spress</a> using the <a target="_blank" href="https://github.com/enzolutions/spress-tinto-theme/">Tinto</a> theme.</span>
<br/>
  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://enzolutions.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://enzolutions.com/assets/js/scripts.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


      <!-- Google Analytics Tracker -->
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-17944133-1', 'enzolutions.com');
        ga('send', 'pageview');
      </script>
      <!-- End of Google Analytics Tracker -->
 </body> 
</html>
